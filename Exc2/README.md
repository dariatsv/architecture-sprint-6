# –ó–∞–¥–∞–Ω–∏–µ 2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–°–µ–π—á–∞—Å —Å–µ—Ä–≤–∏—Å—ã InsureTech —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã –≤ Kubernetes. –ö–∞–∂–¥—ã–π –∏–∑ –Ω–∏—Ö —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤.

–û–±—ã—á–Ω–æ —ç—Ç–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. 

–ù–æ –≤ –ø–µ—Ä–∏–æ–¥—ã –ø–∏–∫–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è: –æ–Ω–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–¥—ã –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ø–∞–º—è—Ç–∏. 

–ö–∞–∫ —Å–ª–µ–¥—Å—Ç–≤–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º. –ë–∏–∑–Ω–µ—Å –≤–∏–¥–∏—Ç, —á—Ç–æ NPS —Å–Ω–∏–∂–∞–µ—Ç—Å—è.

–ú–æ–∂–Ω–æ, –∫–æ–Ω–µ—á–Ω–æ, –¥–µ—Ä–∂–∞—Ç—å –±–æ–ª—å—à–µ —Ä–µ–ø–ª–∏–∫ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã–º–∏, —á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –º–æ–≥–ª–∞ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –ø–∏–∫–æ–≤—ã–º–∏ –Ω–∞–≥—Ä—É–∑–∫–∞–º–∏. –ù–æ —ç—Ç–æ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏ –Ω–µ–≤—ã–≥–æ–¥–Ω–æ –∏ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –Ω–∏–∑–∫–∏–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –ø–æ–º–æ—â—å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏.

–í—ã –±—É–¥–µ—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–≤–∞ —Ä–µ—Å—É—Ä—Å–∞:
```
GET / ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø–æ–¥–∞;
GET /metrics ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus.
```
–ú–µ—Ç—Ä–∏–∫–∞ `http_requests_total` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –º–µ—Ç–æ–¥–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø–æ–¥–∞.

–û–±—Ä–∞–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–±–∞ –º–µ—Ç–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –ø–æ—Ä—Ç—É 8080.

üîç –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –≤ —ç—Ç–æ–º –∑–∞–¥–∞–Ω–∏–∏ –¥–≤–µ —á–∞—Å—Ç–∏ ‚Äî –æ–¥–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è, –¥—Ä—É–≥–∞—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è.

–ú—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ç–æ—Ä—É—é —á–∞—Å—Ç—å, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –≥–ª—É–±–∂–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —Ç–µ–º–µ –∏ –ø–æ–ª—É—á–∏—Ç—å –æ–ø—ã—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∏—Ö –æ—Å–Ω–æ–≤–µ. 

–ì–ª–∞–≤–Ω—ã–π –ø–ª—é—Å —ç—Ç–æ–π —á–∞—Å—Ç–∏ –≤ —Ç–æ–º, —á—Ç–æ —ç—Ç–∞ –∑–∞–¥–∞—á–∞ –±–ª–∏–∂–µ –∫ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏ –∏ –Ω–∞–º–Ω–æ–≥–æ —á–∞—â–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ, —á–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –±–∞–∑–µ –ø–∞–º—è—Ç–∏ –∏ CPU.

–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç —Ü–µ–ª–∏ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –º–µ—Ç—Ä–∏–∫, –º–æ–∂–µ—Ç–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ. –ü–µ—Ä–≤–æ–π —á–∞—Å—Ç–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ–±—â–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏.

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å –∑–∞–¥–∞–Ω–∏—è: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

* –ü–æ–¥–Ω–∏–º–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä Kubernetes –≤ Minikube.
* –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ metrics-server.
* –ù–∞–ø–∏—à–∏—Ç–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è (Deployment) Kubernetes –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
  * –î–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–ø–ª–∏–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ä–∞–≤–Ω–æ–µ –µ–¥–∏–Ω–∏—Ü–µ. –õ–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞–≤–Ω—ã–π ‚Äú30Mi‚Äù. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –≤–∞—à–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ. –í —Ä–∞–º–∫–∞—Ö –ø—É–ª-—Ä–µ–∫–≤–µ—Å—Ç–∞ –¥–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é Exc2.
* –ù–∞–ø–∏—à–∏—Ç–µ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç —Å–µ—Ä–≤–∏—Å–∞ (Service) –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –Ω–∞ –ø—Ä–æ—à–ª–æ–º —à–∞–≥–µ. –í —Ä–∞–º–∫–∞—Ö –ø—É–ª-—Ä–µ–∫–≤–µ—Å—Ç–∞ —Ñ–∞–π–ª —Å —ç—Ç–∏–º –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–º —Ç–æ–∂–µ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é Exc2.
* –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ —Å –ø–æ–º–æ—â—å—é Horizontal Pod Autoscaler (HPA). –î–ª—è –Ω–∞—à–µ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏ —Ä–∞–≤–µ–Ω 80%. –í –∫–∞—á–µ—Å—Ç–≤–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–ø–ª–∏–∫ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 10. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç –≤ –≤–∞—à–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ. –í —Ä–∞–º–∫–∞—Ö –ø—É–ª-—Ä–µ–∫–≤–µ—Å—Ç–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π –º–∞–Ω–∏—Ñ–µ—Å—Ç –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é Exc2.

`minikube service <–∏–º—è —Å–µ—Ä–≤–∏—Å–∞> --url`

* –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ —Å –ø–æ–º–æ—â—å—é Horizontal Pod Autoscaler (HPA). –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –º–µ—Ç—Ä–∏–∫ –≤ –≤–∞—à–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ. –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å ‚Äî –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–æ–π:

`minikube addons enable metrics-server`

* –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–π—Ç–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç –¥–ª—è Horizontal Pod Autoscaler. –≠—Ç–æ—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ—Å—Ç–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (memory). –î–ª—è –Ω–∞—à–µ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏ —Ä–∞–≤–µ–Ω 80%. –í –∫–∞—á–µ—Å—Ç–≤–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–ø–ª–∏–∫ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 10. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç –≤ –≤–∞—à–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π –º–∞–Ω–∏—Ñ–µ—Å—Ç –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é Exc2 –≤ —Ä–∞–º–∫–∞—Ö –ø—É–ª-—Ä–µ–∫–≤–µ—Å—Ç–∞.
* –¢–µ–ø–µ—Ä—å –Ω–∞–¥–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ. –î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è locust:

  * –°–æ–∑–¥–∞–π—Ç–µ Locustfile. –≠—Ç–æ —Å—Ü–µ–Ω–∞—Ä–∏–π –Ω–∞ Python, –≥–¥–µ –≤—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å –∏–º–µ–Ω–µ–º locustfile.py –≤ —É–¥–æ–±–Ω–æ–π –¥–ª—è –≤–∞—Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç—É–¥–∞ –∫–æ–¥:
```
       from locust import HttpUser, between, task
 
       class WebsiteUser(HttpUser):
           wait_time = between(1, 5)
   
           @task
           def index(self):
               self.client.get("/") 
               
```
    
    
–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞—ë—Ç –∫–ª–∞—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É ("/") —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –æ—Ç 1 –¥–æ 5 —Å–µ–∫—É–Ω–¥.
    
   * –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–∞—à locustfile.py. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

        `locust`

   * –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ Locust –æ—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä –∏ –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å http://localhost:8089. –í—ã —É–≤–∏–¥–∏—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Locust, –≥–¥–µ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ hatch rate ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å, —Å –∫–æ—Ç–æ—Ä–æ–π –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏.
   * –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –ü—Ä–æ—â–µ –≤—Å–µ–≥–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –¥–∞—à–±–æ—Ä–¥–µ Kubernetes. –í –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–ª–∞—Å—Ç–µ—Ä–µ Minikube –µ–≥–æ –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã:

        `minikube dashboard`

   * –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–∞—à–±–æ—Ä–¥–∞ –∏–ª–∏ –≤—ã–≥—Ä—É–∑–∏—Ç–µ –ª–æ–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫–∞–∂—É—Ç, —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–º–µ–Ω—è–ª–æ—Å—å –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏—Ö –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é Exc2 –≤ —Ä–∞–º–∫–∞—Ö –ø—É–ª-—Ä–µ–∫–≤–µ—Å—Ç–∞.


## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å –∑–∞–¥–∞–Ω–∏—è: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É

üîç –≠—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ. –ï—Å–ª–∏ —Å–¥–∞–¥–∏—Ç–µ —Ä–∞–±–æ—Ç—É –±–µ–∑ –Ω–µ–≥–æ, —ç—Ç–æ –Ω–µ –æ—Ç—Ä–∞–∑–∏—Ç—Å—è –Ω–∞ —Ä–µ–≤—å—é.

Kubernetes –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª—è—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ CPU –∏ memory. –û–¥–Ω–∞–∫–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –∑–∞—á–∞—Å—Ç—É—é —Ç—Ä–µ–±—É–µ—Ç—Å—è –±√≥–ª—å—à–∞—è –≥–∏–±–∫–æ—Å—Ç—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏—Ö –≤ Kubernetes. –ù–∞–ø—Ä–∏–º–µ—Ä, Prometheus.
–í –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É (RPS) –Ω–∞ –æ–¥–∏–Ω –ø–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

* –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Prometheus –≤ –≤–∞—à–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Prometheus –≤ Kubernetes —Å –ø–æ–º–æ—â—å—é Prometheus Operator —á–µ—Ä–µ–∑ Helm. –õ—É—á—à–µ –≤—Å–µ–≥–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è Prometheus Community Helm charts. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:

```
helm repo add prometheus-community <https://prometheus-community.github.io/helm-charts>
helm repo update
helm install prometheus-operator prometheus-community/kube-prometheus-stack
```

* –¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Prometheus. –î–ª—è —ç—Ç–æ–≥–æ —Å—Ç–æ–∏—Ç –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è Service Monitor. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Prometheus Operator –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Kubernetes –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º Service Discovery. –í–æ—Ç –ø—Ä–∏–º–µ—Ä –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ ServiceMonitor:

```yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
name: scaletestapp-app-sm
namespace: default
labels:
serviceMonitorSelector: prometheus
spec:
endpoints:
- interval: 10s
targetPort: 8080
path: /metrics
namespaceSelector:
matchNames:
- default
selector:
matchLabels:
prometheus-monitored: "true"
```

* –¢—Ä–µ–±—É–µ–º—ã–π —Å–µ—Ä–≤–∏—Å –º–æ–∂–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –ª–µ–π–±–ª–∞ app –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ª–µ–π–±–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, prometheus-monitored), –∫–æ—Ç–æ—Ä—ã–π –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∞–∑–∏—Ç—å –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ Service.
* ServiceMonitor –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∞–Ω–∏—Ñ–µ—Å—Ç –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ–∫—Ü–∏–µ–π additionalServiceMonitors –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Prometheus Operator —á–µ—Ä–µ–∑ Helm. –í–æ—Ç –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Prometheus Operator:
```yaml
defaultRules:
create: false
alertmanager:
enabled: false
grafana:
enabled: false
kubeApiServer:
enabled: false
kubelet:
enabled: false
kubeControllerManager:
enabled: false
coreDns:
enabled: false
kubeEtcd:
enabled: false
kubeScheduler:
enabled: false
kubeStateMetrics:
enabled: false
nodeExporter:
enabled: false
prometheus:
enabled: true
additionalServiceMonitors:
- name: app-sm
namespace: default
labels:
serviceMonitorSelector: prometheus
endpoints:
- interval: 10s
targetPort: 8080
path: /metrics
namespaceSelector:
matchNames:
- default
selector:
matchLabels:
prometheus-monitored: "true"
```

* –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å—Ç—É–ø–∞—é—Ç –≤ Prometheus. –ó–∞–π–¥–∏—Ç–µ –≤ Prometheus Web UI, –æ—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª Graph –∏–ª–∏ Targets, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏ –º–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã. –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É, –Ω—É–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É Prometheus —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã. –ù–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã:
    
  `minikube service <–∏–º—è —Å–µ—Ä–≤–∏—Å–∞> --url`
  
* –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏—Ö –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é Exc2.
  
* –¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Prometheus Adapter –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ—Ç—Ä–∏–∫ Prometheus –≤ Horizontal Pod Autoscaler (HPA). Prometheus Adapter —Å–ª—É–∂–∏—Ç –º–æ—Å—Ç–æ–º –º–µ–∂–¥—É Kubernetes –∏ Prometheus. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç Kubernetes –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ Prometheus –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–æ–≤. –ß—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Prometheus Adapter:
  
  * –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Helm –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Prometheus Adapter, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –±–∞–∑–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é. 
  * –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª values.yaml –∏ –≤–∫–ª—é—á–∏—Ç–µ —Ç—É–¥–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è prometheus-adapter:
    ```yaml
    prometheus:
    url: "http://<–∞–¥—Ä–µ—Å_prometheus>"
    rules:
    default: false
    custom:
    - seriesQuery: 'http_requests_total{namespace!="",pod!=""}'
    resources:
    overrides:
    namespace: {resource: "namespace"}
    pod: {resource: "pod"}
    name:
    matches: "^http_requests_total"
    as: "http_requests_per_second"
    metricsQuery: 'sum(rate(http_requests_total{<<.LabelMatchers>>}[30s])) by (<<.GroupBy>>)'
    ```
  * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Prometheus Adapter –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∫–æ–º–∞–Ω–¥—ã:

    `helm intall prometheus-adapter prometheus-community/prometheus-adapter -f values.yaml`

  * –ß—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–∞—Å—Ç–æ–º–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ http_requests_per_second —Å—Ç–∞–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–π, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–æ–º–∞–Ω–¥–æ–π:

    `kubectl get --raw /apis/custom.metrics.k8s.io/v1beta1`

  * –û–±–Ω–æ–≤–∏—Ç–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç Horizontal Pod Autoscaler. –£–∫–∞–∂–∏—Ç–µ —Ç–∞–º, —á—Ç–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –Ω–∞ –±–∞–∑–µ –Ω–æ–≤–æ–π –º–µ—Ç—Ä–∏–∫–∏ ‚Äî http_requests_per_second. –í–æ—Ç –ø—Ä–∏–º–µ—Ä –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞:
    ```yaml
    apiVersion: autoscaling/v2
    kind: HorizontalPodAutoscaler
    metadata:
    name: scaletestapp-hpa
    spec:
    scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: scaletestapp
    minReplicas: 1
    maxReplicas: 10
    metrics:
    - type: Pods
    pods:
    metric:
    name: http_requests_per_second
    target:
    type: AverageValue
    averageValue: 50
    ```

* –ö–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ —Å–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é Exc2.
* –¢–µ–ø–µ—Ä—å –Ω–∞–¥–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ. –î–ª—è —ç—Ç–æ–≥–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –î–µ–π—Å—Ç–≤—É–π—Ç–µ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –≤–æ—Å—å–º—ã–º —à–∞–≥–æ–º –≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏—è.
* –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–∞—à–±–æ—Ä–¥–∞ –∏–ª–∏ –≤—ã–≥—Ä—É–∑–∏—Ç–µ –ª–æ–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫–∞–∂—É—Ç, —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–º–µ–Ω—è–ª–æ—Å—å –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏—Ö –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é Exc2 –≤ —Ä–∞–º–∫–∞—Ö –ø—É–ª-—Ä–µ–∫–≤–µ—Å—Ç–∞.
